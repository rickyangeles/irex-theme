"use strict";function throttle(e,t,n){var i,r;return function(){var o=n||this,a=+new Date,s=arguments;i&&a<i+t?(clearTimeout(r),r=setTimeout(function(){i=a,e.apply(o,s)},t)):(i=a,e.apply(o,s))}}var FC=FC||{};FC.menu={menuSelector:"",menuItemSelector:"",contentSelector:"",unfoldedContentBefore:"",unfoldedContentAfter:"",closeButtonMarkup:"",init:function(e,t,n,i,r,o){FC.menu.menuSelector=e,FC.menu.menuItemSelector=t,FC.menu.contentSelector=n,FC.menu.unfoldedContentBefore=i,FC.menu.unfoldedContentAfter=r,FC.menu.closeButtonMarkup=o,FC.menu.setupMenu(),FC.menu.labelRows(),FC.events.addParentClickEvent(),FC.events.addCloseClickEvent(),FC.resize.init()},setupMenu:function(){for(var e=jQuery(FC.menu.menuItemSelector,FC.menu.menuSelector),t=jQuery(FC.menu.menuSelector),n=0;n<e.length;n++){var i=e.eq(n),r=i.children(FC.menu.contentSelector);i.data("data-fc-key","fcid-"+n).children("a").attr("href","javascript:"),i.hasClass("folding-parent")||i.addClass("folding-parent"),t.data("fcid-"+n,r),r.remove()}},labelRows:function(){jQuery(".row-end").removeClass("row-end"),jQuery(".row-begin").removeClass("row-begin");var e=jQuery(FC.menu.menuItemSelector,FC.menu.menuSelector),t=-1,n="";e.each(function(){var e=jQuery(this),i=e.position().top;i!=t&&(e.addClass("row-begin"),n=e.prev(),n.hasClass("unfolded-content")&&(n=n.prev()),n.addClass("row-end"),t=i)}),e.last().addClass("row-end")},cleanUpActiveFoldingMenu:function(){jQuery(".active-item").css("height","").removeClass("active-item"),jQuery(".unfolded-content").slideUp(400,function(){jQuery(this).remove()})},activeItemRow:function(e){for(var t="",n=e,i=0;i<100;i++)n.hasClass("row-begin")?(t=n,i+=200):n=n.prev();var r="";n=e;for(var o=0;o<100;o++)n.hasClass("row-end")?(r=n,o+=200):n=n.next();return{begin:t,end:r}},equalizeItemHeight:function(e){for(var t=FC.menu.activeItemRow(e).begin,n=0,i=t,r=jQuery();100>n;)n++,r=r.add(i),i.hasClass("row-end")?n+=200:i=i.next();var o=0;if(r.each(function(){var e=jQuery(this);o<e.outerHeight()&&(o=e.outerHeight())}),e.outerHeight()<o){e.css("height","");var a=e.outerHeight()-e.height(),s=o-a;e.height(s)}}},FC.events={addParentClickEvent:function(){jQuery(FC.menu.menuSelector).on("click tap touch",".folding-parent",function(){var e=jQuery(this);if(e.hasClass("active-item"))return void FC.menu.cleanUpActiveFoldingMenu();FC.menu.cleanUpActiveFoldingMenu(),e.addClass("active-item"),FC.menu.equalizeItemHeight(e);var t='<div class="close-unfolded-content">'+FC.menu.closeButtonMarkup+"</div>";t=FC.menu.unfoldedContentBefore+t+FC.menu.unfoldedContentAfter;var n=FC.menu.activeItemRow(e).end;jQuery(t).insertAfter(n);var i=n.next();i.addClass("unfolded-content");var r=e.data("data-fc-key"),o=jQuery(FC.menu.menuSelector).data(r);o.appendTo(i),i.slideDown(400)})},addCloseClickEvent:function(){jQuery(FC.menu.menuSelector).on("click tap touch",".close-unfolded-content",function(){FC.menu.cleanUpActiveFoldingMenu()})}},FC.resize={init:function(){var e=jQuery(FC.menu.menuSelector);FC.resize.addResizeCanary(e);var t=jQuery(".fc-resize-canary")[0];addResizeListener(t,FC.resize.menuResize)},addResizeCanary:function(e){var t='<div class="fc-resize-canary" style="height: 20px; margin-bottom: -20px;"></div>';jQuery(FC.menu.menuSelector).parent().prepend(t)},menuResize:throttle(function(){var e=jQuery(".unfolded-content").detach();FC.menu.labelRows();var t=jQuery(".active-item");if(t.length){t.css("height",""),FC.menu.equalizeItemHeight(t);var n=FC.menu.activeItemRow(t).end;e.insertAfter(n)}},300)},jQuery.fn.foldingContent=function(e){jQuery(document).ready(function(){var t=e,n=t.menuSelector,i=t.menuItemSelector,r=t.contentSelector,o=t.unfoldBeforeMarkup,a=t.unfoldAfterMarkup,s="";t.closeMarkup&&(s=t.closeMarkup),FC.menu.init(n,i,r,o,a,s)})},function(){function e(){if(!n){var e=(g?g:"")+".resize-triggers { "+(p?p:"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i),n=!0}}var t=document.attachEvent,n=!1;if(!t){var i=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)};return function(t){return e(t)}}(),r=function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(t){return e(t)}}(),o=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,i=t.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},a=function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height},s=function(e){var t=this;o(this),this.__resizeRAF__&&r(this.__resizeRAF__),this.__resizeRAF__=i(function(){a(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach(function(n){n.call(t,e)}))})},u=!1,c="animation",l="",d="animationstart",m="Webkit Moz O ms".split(" "),f="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),v="",h=document.createElement("fakeelement");if(void 0!==h.style.animationName&&(u=!0),u===!1)for(var _=0;_<m.length;_++)if(void 0!==h.style[m[_]+"AnimationName"]){v=m[_],c=v+"Animation",l="-"+v.toLowerCase()+"-",d=f[_],u=!0;break}var C="resizeanim",g="@"+l+"keyframes "+C+" { from { opacity: 0; } to { opacity: 0; } } ",p=l+"animation: 1ms "+C+"; "}window.addResizeListener=function(n,i){t?n.attachEvent("onresize",i):(n.__resizeTriggers__||("static"==getComputedStyle(n).position&&(n.style.position="relative"),e(),n.__resizeLast__={},n.__resizeListeners__=[],(n.__resizeTriggers__=document.createElement("div")).className="resize-triggers",n.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',n.appendChild(n.__resizeTriggers__),o(n),n.addEventListener("scroll",s,!0),d&&n.__resizeTriggers__.addEventListener(d,function(e){e.animationName==C&&o(n)})),n.__resizeListeners__.push(i))},window.removeResizeListener=function(e,n){t?e.detachEvent("onresize",n):(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(n),1),e.__resizeListeners__.length||(e.removeEventListener("scroll",s),e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)))}}();